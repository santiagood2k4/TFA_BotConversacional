<!DOCTYPE html>
<html lang="es">
{% load static %}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bot de Aventura Narrativa - AFD + GLC</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />

  {# Carga Vis.js PRIMERO, ya que script.js puede depender de Ã©l #}
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- Mensaje de bienvenida personalizado -->
    <div class="welcome-message" id="welcomeMessage">
      <span class="welcome-text">ğŸŒŸ Bienvenido, {{ user.username }}! ğŸš€</span>
    </div>
    
    <div class="game-area">
      <h1 class="title">ğŸš€ El Devorador - MisiÃ³n Espacial</h1>
      <div class="story-display" id="storyDisplay">
        <div class="story-text" id="storyText">Cargando aventura...</div>
      </div>

      {# AÃ±adir el contenedor de opciones (aunque ahora se use mÃ¡s el input de texto) #}
      {# Esto evita un error si script.js intenta manipularlo #}
      <div class="options-container" id="optionsContainer"></div>

      <div class="input-container" style="display: flex; margin-top: 20px;"> {# AsegÃºrate de tener este estilo #}
        <input type="text" id="userInput" placeholder="Escribe tu acciÃ³n aquÃ­..." style="flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #4a9eff; background-color: rgba(0,0,0,0.3); color: white;">
        <button id="submitChoice" style="margin-left: 10px; background-color: #4a9eff; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Enviar</button>
      </div>
      
      <!-- BotÃ³n de reinicio cuando el juego estÃ¡ en estado final -->
      <div id="restartContainer" style="display: none; text-align: center; margin-top: 20px;">
        <button onclick="resetGame()" style="background: linear-gradient(45deg, #ffa502, #ff6348); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 16px;">
          ğŸš€ Reiniciar Aventura
        </button>
      </div>
    </div>

    <div class="debug-panel">
      <div class="debug-section">
        <div class="debug-title">ğŸ“Š ESTADO DEL AFD</div>
        <div class="state-indicator" id="currentState">INICIAL</div>
        <div style="margin-top: 10px; font-size: 12px;">
          <strong>Estados visitados:</strong>
          <div id="visitedStates">ninguno</div>
        </div>
      </div>



      <div class="debug-section">
        <div class="debug-title">ğŸ”„ TRANSICIONES POSIBLES (Para debug)</div>
        <div id="possibleTransitions" style="font-size: 12px;">Calculando...</div>
      </div>

      <div class="debug-section">
        <div class="debug-title">ğŸ® CONTROLES</div>
        <button class="reset-btn" onclick="resetGame()">ğŸ”„ Reiniciar Aventura</button>
        <button class="reset-btn" onclick="showAFDInfo()" style="background: #2ed573; margin-top: 5px;">ğŸ“‹ Ver AFD Completo</button>
        <button class="reset-btn" onclick="showHelp()" style="background: #ffa502; margin-top: 5px;">â“ Ayuda</button>
      </div>
    </div>
  </div>

  {# Carga tu script.js DESPUÃ‰S de vis.js y al final del body para asegurar que el DOM estÃ© cargado #}
  <script src="{% static 'js/script.js' %}?v={{ timestamp|default:1 }}"></script>

{# Modals (Mantenerlos al final del body tambiÃ©n es buena prÃ¡ctica) #}
<div id="afdModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('afdModal')">&times;</span>
    <h2>Diagrama del AutÃ³mata Finito Determinista</h2>
    <div id="afdGraph" style="width:100%; height:500px;"></div>
    <div class="afd-details">
      <h3>Detalles del AFD</h3>
      <p><strong>Estados:</strong> <span id="totalStates">0</span></p>
      <p><strong>Transiciones:</strong> <span id="totalTransitions">0</span></p>
      <p><strong>Estados finales:</strong> <span id="finalStates">0</span></p>
    </div>
  </div>
</div>



<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('helpModal')">&times;</span>
    <h2>ğŸ® GuÃ­a de Juego</h2>
    <div class="help-container">
      <div class="help-section">
        <h3>ğŸ“ CÃ³mo Jugar</h3>
        <p>Escribe tus acciones en el campo de texto y presiona "Enviar" o Enter. El juego reconocerÃ¡ diferentes formas de expresar la misma acciÃ³n.</p>
        
        <h3>ğŸ’¡ Ejemplos de Acciones</h3>
        <ul>
          <li><strong>Investigar:</strong> "investigar nave", "examinar", "analizar", "revisar"</li>
          <li><strong>Navegar:</strong> "laboratorio", "bodega", "mÃ©dico", "sector mÃ©dico"</li>
          <li><strong>Comunicarse:</strong> "comunicarse", "hablar", "intentar comunicaciÃ³n"</li>
          <li><strong>Planear:</strong> "planear ataque", "formar alianza", "ejecutar plan"</li>
        </ul>
        
        <h3>ğŸ¯ Objetivo</h3>
        <p>Salva la nave espacial de "El Devorador", una entidad alienÃ­gena que consume la conciencia de sus vÃ­ctimas. Forma alianzas y usa tu ingenio para sobrevivir.</p>
        
        <h3>ğŸ”§ Funcionalidades</h3>
        <ul>
          <li><strong>Reiniciar:</strong> Comienza una nueva aventura</li>
          <li><strong>Ver AFD:</strong> Visualiza el autÃ³mata finito determinista</li>
        </ul>
        
        <h3>ğŸ® Controles del Juego</h3>
        <ul>
          <li><strong>Campo de texto:</strong> Escribe tus acciones aquÃ­</li>
          <li><strong>Enter:</strong> EnvÃ­a tu acciÃ³n rÃ¡pidamente</li>
          <li><strong>Sugerencias:</strong> Aparecen mientras escribes</li>
        </ul>
        
        <h3>ğŸŒŸ Consejos para Jugar</h3>
        <ul>
          <li>Puedes escribir las acciones de diferentes maneras</li>
          <li>El juego reconoce sinÃ³nimos y variaciones</li>
          <li>Explora todos los sectores de la nave</li>
          <li>Forma alianzas con alienÃ­genas y humanos</li>
          <li>Cada decisiÃ³n afecta el resultado final</li>
        </ul>
        
        <h3>ğŸš€ Historia</h3>
        <p>Te despiertas en una nave espacial abandonada en el sector Omega-7. La nave estÃ¡ en cuarentena por una infecciÃ³n alienÃ­gena. DescubrirÃ¡s que "El Devorador" es una entidad que consume la conciencia de sus vÃ­ctimas. Los alienÃ­genas no son la amenaza, son refugiados que buscan tu ayuda.</p>
      </div>
    </div>
  </div>
</div>
</body>
</html>